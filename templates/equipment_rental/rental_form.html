{% extends 'base.html' %}
{% comment %} Name of the file: templates/equipment_rental/rental_form.html {% endcomment %}
{% block content %}
<div class="container">
  <h1 class="mt-4">Equipment Rental Form</h1>
  <form method="post">
    {% csrf_token %}
    <div class="form-group">
      <label for="diver-search">Search for Diver:</label>
      <div class="input-group">
        <input type="text" class="form-control" id="diver-search" name="diver-search" placeholder="Enter diver name">
        <div class="input-group-append">
          <button type="button" class="btn btn-outline-secondary" id="search-button">Search</button>
        </div>
      </div>
    </div>
    <div class="form-group">
      <label for="diver">Selected Diver:</label>
      <select class="form-control" id="diver" name="diver" disabled>
        <option value="" selected disabled>Select a diver</option>
        <!-- Add options for divers dynamically -->
      </select>
    </div>
    <div class="form-group">
      <label for="date_of_rental">Date of Rental:</label>
      <input type="date" class="form-control" id="date_of_rental" name="date_of_rental">
    </div>
    <div class="form-group">
      <label for="date_due">Date Due:</label>
      <input type="date" class="form-control" id="date_due" name="date_due">
    </div>
    <div class="form-group">
      <label for="equipment">Equipment:</label>
      <select multiple class="form-control" id="equipment" name="equipment">
        <option value="" disabled>Select equipment</option>
        <!-- Add options for equipment dynamically -->
      </select>
    </div>
    <!-- Add any other form fields as needed -->
    <button type="submit" class="btn btn-primary">Submit</button>
  </form>
</div>
<script>
  // JavaScript code to handle diver search and selection
  document.getElementById("search-button").addEventListener("click", function () {
    var searchInput = document.getElementById("diver-search").value.toLowerCase();
    var diverSelect = document.getElementById("diver");
    var diverOptions = diverSelect.options;

    // Clear existing options
    diverSelect.innerHTML = '<option value="" selected disabled>Select a diver</option>';

    // Fetch divers from the database matching the search query
    fetch(`/search_divers/?query=${searchInput}`)
      .then(response => response.json())
      .then(data => {
        // Add diver options dynamically
        data.forEach(diver => {
          var option = document.createElement("option");
          option.value = diver.id;
          option.text = diver.name;
          diverSelect.appendChild(option);
        });

        // Enable the diver select field
        diverSelect.disabled = false;
      })
      .catch(error => {
        console.log(error);
      });
  });
</script>
{% endblock %}